name: Build and upload wheels for QE
run-name: Build and upload wheels for QE (disable-optimizations=${{ github.event_name == 'workflow_dispatch' && inputs.disable-optimizations || false }})

on:
  workflow_dispatch:
    inputs:
      disable-optimizations:
        description: 'Build unoptimized wheels?'
        default: false
        type: boolean
        required: false
      python-tags:
        type: string
        required: true
      platform-tag:
        type: string
        required: true

jobs:
  build-artifacts:
    uses: ./.github/workflows/build-wheels.yml
    with:
      python-tags: ${{ inputs.python-tags }}
      platform-tag: ${{ inputs.platform-tag }}
      unoptimized: ${{ inputs.disable-optimizations }}
      sha-to-build-and-test: ${{ github.sha }}
    secrets: inherit

  upload-to-jfrog:
    needs: build-artifacts
    uses: ./.github/workflows/upload-to-jfrog.yml
    with:
      jfrog-repo-name: ${{ vars.JFROG_GENERIC_REPO_NAME }}
    secrets: inherit
